<!DOCTYPE html>
<html>
<head>
<title>JavaScript AJAX</title>
</head>
<body>
<h2>JavaScript AJAX</h2>

<p>1) The XMLHttpRequest Object</p>
<p id="demo1"></p>
<button type="button" onclick="loadDoc()">Click to load</button>

<p>2) parse XML response</p>
<button type="button" onclick="loadXMLDoc()">Click to load XML</button>
<br>
<table id="demo2"></table>

<p>3) AJAX PHP example</p>
<p>typeing a name below to show hints</p>
<form>
First name: <input type="text" onkeyup="showHint(this.value)">
</form>
<p>Suggestions: <span id="demo3"></span></p>


<p id="demo4"></p>
<p id="demo5"></p>
<p id="demo6"></p>
<p id="demo7"></p>
<p id="demo8"></p>
<p id="demo9"></p>
<p id="demo10"></p>
<p id="demo11"></p>
<p id="demo12"></p>
<p id="demo13"></p>
<p id="demo14"></p>
<p id="demo15"></p>
<p id="demo16"></p>
<p id="demo17"></p>
<p id="demo18"></p>
<p id="demo19"></p>
<p id="demo20"></p>

</body>
<script>
function loadDoc(){

    // creating an NEW XMLHttp reqyest object 
    // Note that keyword NEW, it means the object is in heap and
    // will not destroy out of function scope???
    var xhttp = new XMLHttpRequest();

    // The onreadystatechange property defines a callback function 
    // to be executed when the readyState changes.
    // The onreadystatechange event is triggered four times (1-4), 
    // one time for each change in the readyState.
    xhttp.onreadystatechange = function (){
        if (this.readyState == 4 && this.status == 200){
            document.getElementById("demo1").innerHTML = this.responseText;
        }
    }

    // XMLHttpRequest.open(method, url, async)
    // @para method: "GET" / "POST"
    // @para url: the server(file) location
    // @para async: true = asynchronous; false = synchronous
    xhttp.open("GET", "js/ajax_info.txt", true);

    // XMLHttpRequest.send() send request to server (for GET)
    // .send(string) Sends the request to the server (for POST)
    xhttp.send();
}


function loadXMLDoc(){
    var request = new XMLHttpRequest();

    request.onreadystatechange = function (){
        if (this.readyState == 4 && this.status == 200){
            parseXML(this);
        }
    }

    request.open("GET", "js/cd_catalog.xml", true);
    request.send();
}


function parseXML(request){
    var i;

    // get XML from response
    var xml = request.responseXML;
    var table = "<tr><th>Artist</th><th>Title</th></tr>";

    // get all CD nodes
    var x = xml.getElementsByTagName("CD");
    for (i=0; i<x.length; i++){
        table += "<tr><td>" +
        x[i].getElementsByTagName("ARTIST")[0].childNodes[0].nodeValue + 
        "</td><td>" + 
        x[i].getElementsByTagName("TITLE")[0].childNodes[0].nodeValue +
        "</td></tr>";
    }

    document.getElementById("demo2").innerHTML = table;
}

function showHint(input){
    if (input.length==0){
        document.getElementById("demo3").innerHTML = "";
        return;
    } else {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function (){
            if (this.readyState == 4 && this.status == 200){
                document.getElementById("demo3").innerHTML = this.responseText;
            }
        }
        request.open("GET", "php/gethint.php?q=" + input, true);
        request.send();
    }
}
</script>
</html>